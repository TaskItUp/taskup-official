<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TaskUp</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="profile" class="tab-content">
    <div class="profile-header">
        <img src="https://i.pravatar.cc/150" alt="User Profile" class="profile-pic-large">
        <h3 id="profile-name">User</h3>
        <p id="telegram-username" class="text-muted">@username</p>
        <p class="profile-balance">Balance: <span id="profile-balance">0</span> PEPE</p>
    </div>
    <div class="profile-stats">
        <h3 class="section-title">Statistics</h3>
        <div class="stat-item">
            <p><i class="fas fa-chart-line icon-left"></i> Earned So Far</p>
            <p class="stat-value"><span id="earned-so-far">0</span> PEPE</p>
        </div>
        <div class="stat-item">
            <p><i class="fas fa-tv icon-left"></i> Total Ads Viewed</p>
            <p class="stat-value" id="total-ads-viewed">0</p>
        </div>
        <div class="stat-item">
            <p><i class="fas fa-users icon-left"></i> Total Referrals</p>
            <p class="stat-value" id="total-refers">0</p>
        </div>
    </div>
</div>

<button class="refer-fab" onclick="openReferModal()"><i class="fas fa-gift"></i></button>

<div id="refer-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-btn" onclick="closeReferModal()">&times;</button>
        <h2 class="modal-title">Refer Friends, Earn 10% More!</h2>
        <p class="modal-subtitle">Earn a <span class="highlight">10% commission</span> from your friends' earnings!</p>
        <div class="referral-link-container">
            <input type="text" id="referral-link" readonly>
            <button onclick="copyReferralLink(this)"><i class="fas fa-copy"></i></button>
        </div>
        <div class="referral-stats">
            <p><strong><span id="refer-count">0</span></strong> Referrals</p>
            <p><strong><span id="refer-earnings">0</span> PEPE</strong> Earned</p>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <a href="#" class="nav-item active" onclick="showTab('home', this)"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="#" class="nav-item" onclick="showTab('earn', this)"><i class="fas fa-coins"></i><span>Earn</span></a>
    <a href="#" class="nav-item" onclick="showTab('withdraw', this)"><i class="fas fa-wallet"></i><span>Withdraw</span></a>
    <a href="#" class="nav-item" onclick="showTab('profile', this)"><i class="fas fa-user"></i><span>Profile</span></a>
</nav>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDS-X4ZRHlLIBOZJsYKc9oGnNrL6k0J50U",
    authDomain: "taskup-47d9c.firebaseapp.com",
    projectId: "taskup-47d9c",
    storageBucket: "taskup-47d9c.firebasestorage.app",
    messagingSenderId: "889706397464",
    appId: "1:889706397464:web:12e95e738f3f42ba08a86d",
    measurementId: "G-FDKNRDJXQS"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Get Telegram User ID (simulate if not in Telegram)
  const tg = window.Telegram?.WebApp;
  const telegramUserId = tg?.initDataUnsafe?.user?.id?.toString() || "test_user_" + Math.floor(Math.random() * 100000);

  // Parse referrer from URL
  const urlParams = new URLSearchParams(window.location.search);
  const referrerId = urlParams.get("ref");

  // Create user if not exists
  db.collection("users").doc(telegramUserId).get().then(doc => {
    if (!doc.exists) {
      db.collection("users").doc(telegramUserId).set({
        name: tg?.initDataUnsafe?.user?.first_name || "New User",
        telegramUsername: tg?.initDataUnsafe?.user?.username ? @${tg.initDataUnsafe.user.username} : "@newuser",
        balance: 0,
        earnedSoFar: 0,
        totalAdsViewed: 0,
        totalReferrals: 0
      }).

